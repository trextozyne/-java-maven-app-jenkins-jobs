CODE_CHANGE = getGitChanges()
pipeline {
  agent any
  environment {
    NEW_VERSION = '1.3.0'
    // SERVER_CREDENTIALS = credentials('github-credentials') //need to install pugin to allow
  }
  stages {
    stage('Build') {
      steps {
        echo "Building..."
        echo "Building version ${NEW_VERSION}"
        // build steps go here
      }
    }
    stage('Test') {
        when {
            expression {
                # find all this variables in  http://JENKINS_URL:8080/env-vars.html/
                env.BRANCH_NAME == 'dev' || BRANCH_NAME == 'master' && CODE_CHANGE == true
            }
        }
      steps {
        echo 'Testing...'
        // test steps go here
      }
    }
    stage('Deploy') {
      steps {
        echo 'Deploying...'
        // echo "deploying with ${SERVER_CREDENTIALS}"
        // sh "${SERVER_CREDENTIALS}"
        // deploy steps go here
      }
    }
  }
}
